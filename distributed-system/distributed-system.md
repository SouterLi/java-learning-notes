# 分布式系统
## 什么是分布式系统？
概念：分布式系统区别于单机系统，是多台计算机通过网络进行通信，最终组成一个系统。  
目标：分布式系统是为了解决单体系统的一些问题，比如可用性问题，性能瓶颈。
## 它伴随着哪些挑战？
1.性能瓶颈：网络延迟，数据副本同步，分布式事务成本，都会影响性能  
2.容错复杂性：网络分区，节点宕机，脑裂问题，故障恢复后的数据恢复，  
3.数据一致性  

## 如何解决这些挑战？
1.容错复杂性问题  
多副本机制和异地容灾，熔断降级，限流  
2.一致性问题  
CAP选择，根据不同的要求，采用AP或CP，业界成熟方案BASE。  
3.性能优化  
使用Redis缓存，数据分片（数据库分表，冷热数据分离），消息队列，批处理  

## CAP理论
### 1.CAP定义
1.一致性（Consistency）所有节点在同一时刻看到的数据是相同的。例如，写入操作完成后，所有后续的读请求都应返回最新值（强一致性）。  
2.可用性（Availability）每个请求（无论读/写）都能在合理时间内获得非错误响应，即使部分节点故障。  
3.分区容忍性（Partition Tolerance）系统在发生网络分区（节点间通信中断）时仍能继续运行。
### 2.为什么无法同时满足CAP？
当出现网络分区时，比如系统被分成了两个无法相互通信部分A和B
AP：如果此时要满足分区容忍性和可用性，因为A和B无法通信，无法保证A和B的数据一致性，C不成立；
CP：如果要保证一致性和分区容忍性，就必须将B冻结，直接返回B不可用，保证所有可用结果都是从A返回的，才能保证数据一致性，就违反了可用性。
AC：要想满足一致性和可用性，就必须将B部分的服务都停掉，这么此时可用的节点都可以相互通信，就不算网络分区了。
无法同时满足CAP。
### 3.CAP的核心矛盾
- CP：保证一致性和分区容忍性，但牺牲可用性，会影响性能。
    - 例如：ZooKeeper、HBase。在网络分区时拒绝写入，确保数据一致。
    - 场景：金融交易、库存管理等需要强一致性的场景。
- AP：保证可用性和分区容忍性，但牺牲一致性。
    - 例如：Cassandra、DynamoDB。允许节点返回旧数据，但服务始终可用。
    - 社交网络、实时推荐系统等容忍短暂不一致的场景。
### 4.BASE理论
基本可用，最终一致，软状态
基本可用：牺牲一些非核心系统的可用性，或者牺牲一定的响应速度，来保证核心系统的可用性
最终一致：保证在一定时间内，保证数据同步一致。
软状态：允许数据在多个节点中的数据存在同步延迟的情况
