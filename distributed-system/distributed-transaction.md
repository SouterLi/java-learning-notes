# 分布式事务
分布式事务就是数据库事务的分布式版本，保证多个数据库的数据操作满足ACID四个特性。
## 实现方案
### 1.2PC
分为两个步骤，步骤一，事务协调者A询问所有事务参与者B1到Bn是否ready，B回复ready，A通知所有B参与者提交。  
如果出现异常，A通知所有B回滚。  
缺点：事务完成前，所有事务参与者都要锁定，影响并发性能。第一步的时候所有B就已经开始事务了，如果此时有一个B不在线，在步骤二的时候A发现了，会通知所有B回滚，造成资源浪费。
### 2.3PC
事务协调者A询问所有事务参与者B是否canCommit，所有B回复A可以，再按照2PC的流程走  
相比2PC的优点：不会出现因为某一个B不在线导致的资源浪费。但是并发性能的问题依然存在。
### 3.TCC
类似2PC，但是实现方式是在业务代码中实现  
优点是阻塞粒度小，缺点是代码入侵强
### 4.Saga
消息协调者发送commit请求，各个事务参与者直接操作各自的事务，如果成功，返回给事务协调者一个成功的消息，结束。  
如果其中某一个失败了，事务协调者发现后，给所有事务参与者发送回滚请求，所有事务参与者进行回滚。  
## 5.消息最终一致性
使用mq，事务A完成自己的事务，发送消息给MQ，另一个事务订阅这个消息，然后开始自己的事务，如果成功就结束，如果失败，返回MQ一个失败消息，MQ会发送重试。

 
