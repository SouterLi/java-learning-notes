# MySQL常见面试题

## 1.你是什么做sql性能优化的？
1. **索引优化**：
   - 确保查询条件列有索引，优先使用联合索引，并遵循最左前缀原则。
   - 覆盖索引：索引的列包含了所有要返回的列，查询仅通过索引就能获取需要的数据，避免回表。
   - 定期检查并删除未使用的索引。
2. **SQL语句优化**：
   - 避免使用 `SELECT *`，只查询需要的列。
   - 确保 `JOIN` 字段有索引，且小表在左边。
   - 避免隐式类型转换，确保查询条件类型一致。
3. **数据库设计优化**：
   - 适当冗余数据，减少 `JOIN` 操作。
   - 使用分区表或分库分表策略，降低单表数据量。
4. **缓存策略**：
   - 使用 Redis 等缓存热点数据，减少数据库压力。

## 2.sql优化后性能提升了多少？你是怎么测量和判断性能提升了百分之多少？
top sql 性能提升最高超过 10倍，平均可以提升 100% 以上。  
1. **执行计划对比**：使用 `EXPLAIN` 命令查看优化前后的执行计划，分析查询的成本和步骤。
2. **响应时间对比**：在相同数据量和负载下，记录查询的响应时间，比较优化前后的差异。
3. **日志分析**：通过分析数据库日志，查看查询的执行时间和频率，评估优化效果。

根据上述数据，计算性能提升的百分比。

## 3.讲一下mysql中的事务隔离级别？
mysql 的事务隔离级别一共有 4 种
1. **读未提交**：这种隔离级别会出现脏读的情况。
2. **读已提交**：这种不会出现脏读，但是会出现不可重复读。它的原理是每次提交修改的时候生成一个 readview，事务读的是 readview，这就避免了取到未提交的数据。
3. **可重复度**：这种隔离级别不会出现脏读和不可重复读，但是会出现幻读。
4. **串行**：完全不支持多个事务并发执行，避免了幻读，但是性能很差。

## 4.你知道数据库事务吗，一般是怎么使用事务的？
数据库事务是指一组操作的集合，这些操作要么全部成功，要么全部失败，保证数据的一致性和完整性。事务具有四个基本特性，简称为 ACID：
1. **原子性（Atomicity）**：事务中的所有操作要么全部成功，要么全部失败。
2. **一致性（Consistency）**：事务执行前后，数据库都处于一致的状态。
3. **隔离性（Isolation）**：不同事务之间相互隔离，互不干扰。
4. **持久性（Durability）**：一旦事务提交，数据的修改是永久性的，即使系统崩溃也不会丢失。

我一般使用 Transactional 注解来管理事务。
在方法上添加 @Transactional 注解，表示该方法需要在事务中执行。
Spring 会自动处理事务的开始、提交和回滚。

### 5.Transactional注解有失效的时候吗？如果有，是什么情况？
@Transactional 注解在以下情况下可能会失效：
1. **内部方法调用**：如果在同一个类中调用带有 `@Transactional` 注解的方法，Spring 不会拦截这个调用，因此事务不会生效。解决方法是将该方法提取到另一个类中，或者使用 AOP 代理。
2. **非 public 方法**：`@Transactional` 注解只对 public 方法有效。如果在类中使用了 `@Transactional` 注解，但方法是 private、protected 或 package-private，则事务不会生效。
3. **异常类型**：默认情况下，`@Transactional` 只会对`RuntimeException`和`Error`进行回滚。如果抛出的是受检异常（`Checked Exception`），则不会回滚事务。可以通过设置 `rollbackFor` 属性来指定需要回滚的异常类型。
4. **事务传播行为**：如果在同一个事务中调用了另一个事务方法，并且传播行为设置为 `REQUIRES_NEW`，则会创建一个新的事务，这可能导致原有事务失效。
5. **数据库引擎不支持事务**：如果使用了不支持事务的数据库引擎（如 MyISAM），则 `@Transactional` 注解不会生效。
6. **AOP 代理问题**：如果使用了 CGLIB 代理且注解放在了接口类而不是实现类，会导致事务失效。
7. **多线程环境**：在多线程环境中，如果事务方法被多个线程并发调用，可能会导致事务失效。因为每个线程都有自己的事务上下文，无法共享事务状态。

## 6.MySQL使用InnoDB查询就一定不用回表吗
不是的。如果你使用的查询条件是二级索引，那么第一步会根据二级索引查询对应的主键ID，然后进行回表，根据主键ID查询聚簇索引，才可以查到数据。

## 7.MySQL 是如何避免幻读的？
MySQL 通过使用锁机制来避免幻读。
在可重复读隔离级别下，MySQL 使用间隙锁（Gap Lock）来锁定范围内的记录，从而防止其他事务在该范围内插入新记录。
这样可以确保在一个事务中多次读取同一范围时，结果是一致的，不会出现幻读现象。

## 8.索引在哪些情况下会失效？
- 条件列使用函数
- 条件列隐式类型转换
- 条件列使用了不等于（<>）、IS NULL、LIKE '%xxx'等操作
- 条件列没有使用最左前缀
- OR 连接多个条件时，前面的条件没有使用索引
- 复合索引没有遵循最左前缀原则
- 数据分布不均匀，导致索引选择不当