# MySQL
## 聚簇索引
### 什么是聚簇索引
聚簇索引是 InnoDB 存储引擎的核心特性，它决定了表中数据的物理存储顺序。与普通索引不同，聚簇索引的叶子节点直接存储完整的行数据（而非指向数据的指针），因此一个表只能有一个聚簇索引。 
非叶子节点：存储主键和指向子节点的指针。
叶子节点：存储 完整的行数据（所有列的值）。
### 聚簇索引为什么用B+树
  1.减少磁盘 I/O（矮胖的树结构）。  
  2.高效支持范围查询（叶子节点链表）。  
  3.稳定的查询性能（所有查询到叶子节点）。  
  4.适配数据库的读写模式（聚簇索引优化点查，二级索引支持灵活查询）。
### 聚簇索引有什么优点和缺点
  优点  
  1.主键查询极快：直接通过 B+树定位到数据，无需回表。  
  2.范围查询高效：相邻数据物理上连续存储，减少磁盘 I/O。  
  3.覆盖索引优化：若查询的列全部在索引中，无需访问数据行。  
  缺点  
  1.插入速度依赖主键顺序：若主键非自增（如 UUID），随机插入可能导致页分裂，影响性能。  
  2.更新主键代价高：修改主键会导致数据行物理位置变动（InnoDB 会隐式创建新行并删除旧行）。  
  3.二级索引需回表：通过二级索引查询非索引列时，需额外查找聚簇索引（可通过覆盖索引优化）。  
### MySQL使用InnoDB查询就一定不用回表吗
不是的。如果你使用的查询条件是二级索引，那么第一步会根据二级索引查询对应的主键ID，然后进行回表，根据主键ID查询聚簇索引，才可以查到数据。
## mysql中的几个log
#### Binlog
逻辑日志（记录 SQL 语句或行变更）  
作用：数据同步，数据恢复
#### Redo Log
物理日志，记录页级别的修改，比如修改文件A的第100页偏移量50处的字节为值X。Redo Log遵循WAL原则，先写log，再写数据，只要redolog写完，事务就可以提交了。  
作用：保证事务持久性，在事务提交前，先将变更写入 Redo Log，即使崩溃也能恢复  
#### Undo Log
逻辑日志，存储在系统表空间或独立的 Undo 表空间  
作用：保证事务的原子性，用于事务回滚，MVCC  
## SQL调优
#### 索引优化
合理创建索引：条件列创建索引，优先使用联合索引，并遵循最左前缀原则，避免在索引列上使用函数  
覆盖索引：索引的列包含了所有要返回的列，查询仅通过索引就能获取需要的数据，避免回表  
避免冗余索引：定期检查并删除未使用的索引  
#### SQL语句优化
避免 SELECT *  
确保 JOIN 字段有索引，join的两个表，小表在左边，小表驱动大表  
避免隐式类型转换  
数据库设计优化  
适当冗余可减少 JOIN  
大表按时间/范围分区，水平分表  
#### 缓存策略
使用 Redis 缓存热点数据