# Redis的高可用方案
## 1.Redis Cluster
Redis Cluster是Redis的分布式集群方案，Redis Cluster采用去中心化的分布式架构。
### Redis Cluster架构设计
- **哈希槽分片**：整个集群被划分为16384个哈希槽，保证数据分布的均匀性。
- **主从复制**：每个主节点可以有多个从节点，从节点用于数据备份和读请求分担。
- **节点通信**：节点之间通过Gossip协议进行通信，保证集群状态的一致性。

### 故障检测与转移
- **故障检测**：通过Gossip协议，节点可以检测到其他节点的状态。
- **故障转移**：当主节点发生故障时，从节点可以自动提升为主节点，保证数据的可用性。

### Redis的选举机制
当节点发现主节点不可用时，重新发起选举。  
采用Raft算法实现，优先选择赋值偏移量最大的从节点。  
获得集群半数以上的节点同意后，新的主节点就会被选举出来。

## 2.哨兵模式
Redis哨兵模式通过独立的哨兵节点来监控主从节点的状态，采用中心化思想。主要可以实现如下功能：
- **监控**：哨兵节点定期检查主从节点的状态，判断主节点是否可用，如果节点不可用会标记为下线状态。
- **自动故障转移**：当主节点被标记为客观下线时，哨兵会启动故障转移，从节点中选择一个最优的提升为主节点。并通知其他节点更新配置。
- **配置提供**：哨兵节点可以提供当前主节点的地址给客户端，保证客户端可以连接到正确的主节点。
### 哨兵模式的故障转移流程
1. **故障检测阶段**：哨兵节点定期检查主从节点的状态，如果发现节点无响应，标记为主观下线，哨兵通过发布订阅与其他哨兵通信，当足够多的哨兵都认为节点不可达时，标记为客观下线。
2. **leader哨兵选举阶段**：当主节点被标记为客观下线时，哨兵会通过Raft算法选举一个leader哨兵，来负责故障转移。
3. **故障转移阶段**：leader哨兵会在从节点中选择最优候选(考虑复制偏移量、优先级等因素)，并将此节点提升为新的主节点，并通知其他哨兵和客户端更新配置。